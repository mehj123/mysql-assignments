SELECT * FROM (SELECT 
	USERS.USERS_ID as MEMBER_ID,
	REPLACE( substr( USERREG.LOGONID, 1 , locate('::' , USERREG.LOGONID)+1) , '::' , '' ) as STORENAME,
	substr( USERREG.LOGONID, locate('::' , USERREG.LOGONID)+2 ) as LOGONID,
	ADDRESS.PERSONTITLE as PERSONTITLE, 
	ADDRESS.FIRSTNAME as FIRSTNAME,
	ADDRESS.LASTNAME as LASTNAME,
	ADDRESS.PHONE1 as PHONE1,
	USERDEMO.GENDER as GENDER,
	USERDEMO.DATEOFBIRTH as DATEOFBIRTH,
	(SELECT STLOC.IDENTIFIER AS FavouriteStore FROM  STLOC WHERE USERS.FIELD1  = cast(STLOC.STLOC_ID  AS VARCHAR(25))and  USERS.FIELD1 not like '%[^0-9]%' and  USERS.FIELD1 != '' ) as FavouriteStore,	
	USERDEMO.COMPANYNAME as NATIONALITY,
	USERS.REGISTRATION as REGISTRATION,
	USERS.LASTSESSION as LASTSESSION,
	USERPROF.TAXPAYERID as VAT_REGISTRATION_NO,
	USERDEMO.FIELD7 as LANGUAGE_PREFERENCE,
	USERS.FIELD3 as FIELD3
	
FROM USERS
INNER JOIN USERREG ON USERREG.USERS_ID  = USERS.USERS_ID 
INNER JOIN ADDRESS ON ADDRESS.MEMBER_ID = USERS.USERS_ID
LEFT OUTER JOIN USERDEMO ON USERDEMO.USERS_ID = USERS.USERS_ID
LEFT OUTER JOIN USERPROF ON USERS.USERS_ID = USERPROF.USERS_ID
where ADDRESS.SELFADDRESS = 1
and USERS.REGISTERTYPE = 'R'
and ADDRESS.STATUS = 'P' AND 
((DATE(USERS.REGISTRATION)>='2019-05-19' AND DATE(USERS.REGISTRATION)<='2019-05-19') OR (((DATE(USERS.REGISTRATIONUPDATE)>='2019-05-19' AND DATE(USERS.REGISTRATIONUPDATE)<='2019-05-19'))) 
order by USERREG.LOGONID asc )
WHERE StoreName in ('ACE','PLUGINS');
